### MySQL架构

#### MySQL介绍

1. MySQL Server

   MySQL Server是由**SQL层**和**存储引擎层组成**的，每一层各自都包含有协调工作的子模块

   * SQL层：

     权限判断，SQL解析，查询缓存

   * 存储引擎层：

     完成底层数据库的数据存储操作

   基本的运行流程

   1. 客户端发起SQL请求，服务端的连接线程处理层处理客户端的请求，身份验证并检查数据库的安全性
   2. 服务端查询缓存和分析SQL是核心
   3. 将最后的请求转交给优化器获取数据

2. 物理文件组成

   查询存储的文件的地址

   ```mysql
   show variables like "%datadir%"    # 显示地址一般都是 /var/lib/mysql/...，所有的文件都在该文件下进行存储
   ```

   * 日志文件

     1. 记录数据库的操作信息和错误信息

     2. 组成

        * 错误日志：记录错误信息和启动关闭的信息

        * 二进制日志：记录修改数据库的操作，每条语句的执行时间和资源消耗，记录相关的事务

        * 查询日志：记录所有的select查询信息，比较庞大，尽量少开启

        * 慢查询日志：记录所有的之心改时间超过SQL的最大查询上限的语句，可以针对该语句调优

          ```mysql
          select @@long_query_time    # 现实最大查询上限时间
          ```

        * Redo日志：记录了所有的物理变更和事务信息，加强了安全性

   * 数据文件

     我们在`/var/lib/mysql`文件夹下可以查看到基本的数据文件，每个数据库会对应建立一个目录用来存储数据

     * .frm : 所有的存储引擎都会常见这样的存储文件，一个表对应一个，存放与表相关的数据信息，包括表结构的定义信息，数据库崩溃的时候，可以通过该文件回复表结构
     * .MYD : MyISAM不支持事务的存储引擎的创建方式，存放MyISAM的数据
     * .MYI : 存放索引的数据数，保留缓存信息
     * .ibd / ibdata: 存放InnoDB的数据信息，主要包括索引信息,ibdata共享表方式存储数据，独享表的方式使用ibd
     * opt : 数据库的属性信息，比如数据库的编码等等

   * 其他文件

     配置文件基本上都在`/etc/mysql`中

3. 逻辑块介绍

   ​