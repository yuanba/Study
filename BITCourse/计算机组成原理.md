# 计算机组成原理

电子计算机分类

* 电子模拟计算机  处理信息是连续变化的物理量，运算过程连续
* 电子数字计算机  处理的信息是时间上的离散数字量，运算过程不连续，通常意义下的计算机

## 电子计算机发展

### 发展史

* 第一代  电子管计算机
* 第二代  晶体管计算机
* 第三代  中小规模集成电路计算机
* 第四代  超大规模集成电路计算机

### 发展趋势

* 计算机微型化
* 计算机巨型化

### 存储程序概念

存储程序的特点

* 五大基本设备
  * 运算器 : 原始的中心
  * 存储器 : 成为瓶颈，存储器的访问速度，目前的中心
  * 控制器
  * 输入设备
  * 输出设备
* 使用二进制来存储指令和数据
* 程序和数据存入存储器，然后启动运行

## 计算机的硬件组成

1. 运算器和控制器合称中央处理器(CPU)
2. 中央处理器和主存储器(内存)合称主机，除去主机之外的硬件设施统称外设

### 主要部件

* 存储器

  存储器是用来存放程序和数据的部件，在计算机系统中，较大规模的存储器往往分成若干个等级成为**存储系统**

  高速缓存(Cache) -> 主存储器 -> 辅助存储器

  * Cache:

    因为CPU的处理速度非常高，有时候为了让存储器的访问速度可以匹配CPU在主存中增设高速缓存，速度比主存快，容量更小存储我们的最急需处理的程序和数据快速的像CPU提供指令和数据

  * 主存储器:(内存)

    直接有CPU访问，速度快容量小，存储当前的执行的程序和数据

  * 辅助存储器

    存储大，价格低，速度慢，存储暂时不需要执行的程序和数据，CPU不可直接访问，数据先送到主存在送到CPU

* 输入设备 / 输出设备 : 辅助存储器也可以作为

* 运算器 :

  1. 对信息处理和运算的部件
  2. 基础运算
     * 算数运算
     * 逻辑运算
  3. 核心 : 加法器
  4. 其他 : 通用寄存器和累加寄存器，暂存运算结果

* 控制器

  1. 主要功能 : 按照任务预先确定的操作书序控制计算机的各个部件的运行
  2. 输入 : 从主存中读取指令分析，安排操作顺序
  3. 输出 : 向各各部件发送操作信号
  4. 其他 : 包含有专用的寄存器

CPU = 运算器 + 控制器

主机 = CPU + 主存

### 计算机各大部件的连接
* 总线结构(小微型计算机)
    **可以为多个部件服务的公共信息的传送线路，分时的发送和接收消息**
    使用总写结构可以减少我们的信息传送的线的数目提高扩展外部设备的灵活性，提高CPU的工作效率
    * 单总线结构
      单总线又称系统总线，在这种情况下，CPU,主存，外设(通常需要用接口架在总线上)之间可以直接信息交换，主存和外设之间的信息交流无需CPU的干预
    * 总线分类
      * 地址总线 : **单方向**的多个信号线，用于CPU像主存和外设传输地址信息
      * 数据总线 : **双方向**的多个信号线，读入写出设备
      * 控制总线 : **双向**,传送控制命令和接收反馈信号
    * 特点
      * 共享
      * 实时

* 大中型计算机结构

    着重于系统功能的扩大和效率的提高

    * 主机
    * 通道 : 承担I/O操作的管理主要部件，一个通道可以连接一台或者多台设备控制器 ，规模扩大可以发展成外围处理机
    * 设备控制器 : 可以连接一台或者多台外设
    * 外设

### 计算机视图

* 一般用户 : 输入输出设备

* 专业用户

* 计算机设计者 : 

  计算机 -> 系统级(控制器，存储器，外设，运算器) -> 运算器(寄存器) -> 寄存器(门电路) -> 门电路(晶体管) -> 晶体管(CMOS , TTL)

### 存储器设计

* Von结构

  1. 指令和数据混合存储在一个存储器中，共享数据总线，数据宽度一致

  2. 缺点:

     总线拥挤 : 指令和操作数据不能同时存取导致运算速度有限，一次只能取一种且速度低于CPU

  3. 优点 : 存储效率高

* 哈佛结构

  1. 存储器分开 : 程序存储器，数据存储器
  2. 至少2组总线 : 程序数据地址总线，数据数据地址总线
  3. 存取数据和指令不会互相影响
  4. 一个机器周期内，可以同时准备好指令和操作数，在本条指令执行的同时可以预先读取下一个指令

* 应用

  Cache : 哈佛结构

  主存 : Von结构

  好处 : 提高主存利用率，提高程序执行效率

## 计算机系统

1. 分类 : 硬件系统 , 软件系统
2. 一项功能如何实现取决于硬件和软件的哪个高效

### 系列机和软件兼容

1. 系列机存在相同的机器属性和系统结构，在多个方面保证系列机统一从而使得我们的软件兼容
2. 向后兼容 : 程序可以不加修改直接运行在后期发布的型号的系列机上

### 多层次结构

1. 以功能划分

2. 划分层

   * 0 : 硬连逻辑级，计算机内核，逻辑电路组成
   * 1  : 微程序级，硬件直接执行
   * 2 : 机器的指令集，直接给微程序解释

   ---

   * 3 : 操作系统级 : 管理软硬件资源
   * 4 : 汇编语言级 : 用汇编程序打包成汇编代码
   * 5 : 高级语言级
   * 6 : 应用语言级

3. 实际机器和虚拟机器

   * 实际机器 : 

     硬件和固件(软件功能的硬件)实现的机器 0 ~ 2

     不同的CPU使用的机器指令是不相同的

   * 虚拟机器 : 软件或者软件实现为主的机器 3 ~ 6

## 计算机工作过程和性能指标

### 工作过程

1. 编制好的程序放置在主存中控制器逐条读取处理执行

### 性能指标

* 机器字长

  1. 参与运算的数的基本位数，一般等于内部寄存器的大小(加法器 ， 寄存器，数据总线位数决定)，标志这精度，字长越长精度越大(8,16,32,64)

  2. 字节基本单位

     1 B = 8 bit

     为了更灵活的表达和处理信息引入字节单位

  3. 字 : 数据字，一个系列机的数据字长度应该是一致的 16bit , 32bit

  4. 字和字节的区别

     * 字长是运算宽度，反应计算机的信息处理能力
     * 字是度量单位

* 数据通路的宽度

  1. 数据总线一次能够并行处理的信息的位数，数据通路宽度
  2. 影响数据的信息的**传送能力** , 进而影响有效的处理速度
  3. 数据通路宽度 = 数据总线的宽度
  4. 外部的数据总线的通路宽度和CPU内部的基本一致

* 主存容量

  一个主存储器可以存储的全部信息量成为主存容量，通常用字节数来衡量，主存可以存放的信息越多，处理问题的能力越强

  * 字节编制
  * 字编制 : 字数 × 字长

* 运算速度

  * 吞吐量 : 系统单位时间内处理的请求的数量

  * 响应时间 : 

    1. 系统对请求的响应时间
    2. 相应时间 = CPU(程序运行花费) + 等待时间(磁盘访问，存储器访问，I/O操作 ， 操作系统开销)

  * 主频 : 时钟频率，CPU的数字脉冲信号震荡的速度

  * CPU时钟周期 : 主频的倒数，**CPU最小的时间单位**，每个动作最少一个时钟周期

  * CPI:

    1. 每条指令执行的**平均**时钟周期数

    2. 现代技术的发展并行化 : 一个时钟周期可以处理处理很多的指令

       $$IPC = \frac{1}{CPI}\ \ 每个时钟周期的执行的指令数目$$

  * CPU执行时间

    $$CPU = \frac{指令数 * CPI}{时钟频率}$$

    $$MIPS = \frac{主频}{CPI}$$  每秒执行多少百万条指令

## 数据的机器表示

* 无符号和带符号数

  机器字长是n + 1位

  * 无符号数 : $$0\ \ -\ \ 2^{n+1} - 1$$ 
  * 带符号数 : 取决于表示法

* 表示法

  * 原码表示法 : 

    1. 纯小数 : 正数不变，负数头0变1

    2. 纯整数 : 正数不变，负数头0变1

    3. 小心有两种0 : 

       * +0 : 00000
       * -0 : 10000

    4. 评价

       直观易懂，机器码和真值之间转换容易，原码实现惩处运算简单，但是减法困难　

  * 补码表示法

    1. 同余和模的概念

       只要确定了模，就可以找到一个和负数具有等价效果的正数，从而用加法取代减法

       对与一个n为机器字长的机器来说，减数x应该怎么表示呢:

       因为模是$$2^{n}$$,对x取反得到了y,$$y+x=2^{n}-1$$,所以我们对应的和x等价的正数就是$$y+1$$,这也是取反加1的由来

    2. 纯小数 : 正数不变，负数头变1,小数位取法加1

    3. 纯整数 : 同上

    4. 更好的转换方法

       * 原码取反加1
       * 源码从低位到高位，找到第一个1，右边不变，左边取反

    5. 0只有一种 : 00000

  * 反码表示法 

    1. 正数不变，负数原码除符号位不变其他取反
    2. 0:
       * +0 : 00000
       * -0 : 11111

  * 移码表示法 :

    补码的最高位取反，0唯一，吧数据映射到正数域

  表示法的比较

  1. 除了原码的符号为不参与运算，补码和反码都要参与运算
  2. 0
  3. 原码和反码数据大小正负对称，补码负数多一个数(10000 , 因为只有一种0)

* 定点表示和浮点表示

  机器零 : 尾数是0，阶码是最小值

* 非数值表示

  1. ASCII : 一个字节，左7位存储，最高位奇偶校验，或者检查错误或者作为汉子和英文的区分标志

  2. 字符串的存放 :

     * 向量法 : 连续存储的字符，存储其中战友连续的空间
     * 串标法 : 每个字符代码后有一个链接字记录下一个字符的存储单元地址

  3. 汉字 :

     * gb2312国标码 : gb12345 -> gbk

     * 汉字区位码 : 

       这是最后的步骤，在计算机中查找对应的汉字

       国标码 = 区位码H + 2020H

     * 汉字机内码 :

       汉字机内码 = 国标码 + 8080H

       汉字机内码 = 区位码 + A0A0H　->　找到对应的表示

     * 汉字字形码 : 点阵图(16b*16b = 32B)

  4. 万国码

     unicode : 

     一个字符的unicde编码是确定的，但是实际传输的过程中，平台不一致，处于节省空间的考虑实现方式会有所不同(utf8 , utf16,utf32)

     * 编码方式
     * 实现方式 : 

  5. 十进制数和数串的表示

     ​